<!DOCTYPE html>
<html lang="English">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Consensus Protocol | TOP Developer documentation</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="TOP Developer documentation">
    <meta property="og:title" content="Consensus Protocol">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/en/AboutTOPNetwork/Protocol/ConsensusProtocol/">
    <meta property="og:image" content="undefined">
    <meta name="twitter:title" content="Consensus Protocol">
    <meta name="twitter:url" content="/en/AboutTOPNetwork/Protocol/ConsensusProtocol/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="undefined">
    <meta name="image" content="undefined">
    
    <link rel="preload" href="/assets/css/0.styles.3eafe263.css" as="style"><link rel="preload" href="/assets/js/app.a0770211.js" as="script"><link rel="preload" href="/assets/js/5.8d217a8a.js" as="script"><link rel="preload" href="/assets/js/1.dc65fe2a.js" as="script"><link rel="preload" href="/assets/js/4.29ff2e2e.js" as="script"><link rel="preload" href="/assets/js/17.f75481fe.js" as="script"><link rel="prefetch" href="/assets/js/10.385ff05f.js"><link rel="prefetch" href="/assets/js/100.19c411fc.js"><link rel="prefetch" href="/assets/js/101.601d1ea5.js"><link rel="prefetch" href="/assets/js/102.ba90a375.js"><link rel="prefetch" href="/assets/js/103.fd4e0c0d.js"><link rel="prefetch" href="/assets/js/104.ede42e98.js"><link rel="prefetch" href="/assets/js/105.84a21bb5.js"><link rel="prefetch" href="/assets/js/106.3ecce9ee.js"><link rel="prefetch" href="/assets/js/107.86ce69f6.js"><link rel="prefetch" href="/assets/js/108.dca61853.js"><link rel="prefetch" href="/assets/js/109.b8adcebd.js"><link rel="prefetch" href="/assets/js/11.6755bd39.js"><link rel="prefetch" href="/assets/js/110.6c64d5ee.js"><link rel="prefetch" href="/assets/js/111.439b7d7b.js"><link rel="prefetch" href="/assets/js/112.48a1b9ca.js"><link rel="prefetch" href="/assets/js/113.0afffa34.js"><link rel="prefetch" href="/assets/js/114.4535760a.js"><link rel="prefetch" href="/assets/js/115.879d527e.js"><link rel="prefetch" href="/assets/js/116.1cfbf535.js"><link rel="prefetch" href="/assets/js/117.fbafa839.js"><link rel="prefetch" href="/assets/js/118.28d3262c.js"><link rel="prefetch" href="/assets/js/119.ec4b608f.js"><link rel="prefetch" href="/assets/js/12.2806a957.js"><link rel="prefetch" href="/assets/js/120.c2788984.js"><link rel="prefetch" href="/assets/js/121.b2875893.js"><link rel="prefetch" href="/assets/js/122.2773f40f.js"><link rel="prefetch" href="/assets/js/123.fa76cc35.js"><link rel="prefetch" href="/assets/js/124.3cfda310.js"><link rel="prefetch" href="/assets/js/125.e57694fe.js"><link rel="prefetch" href="/assets/js/126.e91a9c63.js"><link rel="prefetch" href="/assets/js/127.772a1e68.js"><link rel="prefetch" href="/assets/js/128.2acab9fe.js"><link rel="prefetch" href="/assets/js/129.8b7ec746.js"><link rel="prefetch" href="/assets/js/13.e77c8d55.js"><link rel="prefetch" href="/assets/js/130.338e04ad.js"><link rel="prefetch" href="/assets/js/131.4c5d20b1.js"><link rel="prefetch" href="/assets/js/132.d84bfbb2.js"><link rel="prefetch" href="/assets/js/133.55fb1921.js"><link rel="prefetch" href="/assets/js/134.cb95952f.js"><link rel="prefetch" href="/assets/js/135.c47ca869.js"><link rel="prefetch" href="/assets/js/136.583e44e1.js"><link rel="prefetch" href="/assets/js/137.b8af454d.js"><link rel="prefetch" href="/assets/js/138.4c97dfd9.js"><link rel="prefetch" href="/assets/js/139.7daf72da.js"><link rel="prefetch" href="/assets/js/14.03383b61.js"><link rel="prefetch" href="/assets/js/140.7743159a.js"><link rel="prefetch" href="/assets/js/141.2d8a6338.js"><link rel="prefetch" href="/assets/js/142.1f3303c4.js"><link rel="prefetch" href="/assets/js/143.9e1d7b66.js"><link rel="prefetch" href="/assets/js/144.34ed8114.js"><link rel="prefetch" href="/assets/js/145.f1cf2687.js"><link rel="prefetch" href="/assets/js/146.75fcd922.js"><link rel="prefetch" href="/assets/js/147.59789787.js"><link rel="prefetch" href="/assets/js/148.b50e2710.js"><link rel="prefetch" href="/assets/js/149.bfa2d3e5.js"><link rel="prefetch" href="/assets/js/15.1ad9c383.js"><link rel="prefetch" href="/assets/js/150.38eef2da.js"><link rel="prefetch" href="/assets/js/16.b87330de.js"><link rel="prefetch" href="/assets/js/18.e25c4f4e.js"><link rel="prefetch" href="/assets/js/19.ab9d4735.js"><link rel="prefetch" href="/assets/js/20.071d5ade.js"><link rel="prefetch" href="/assets/js/21.c486e280.js"><link rel="prefetch" href="/assets/js/22.c741366a.js"><link rel="prefetch" href="/assets/js/23.3bb487fc.js"><link rel="prefetch" href="/assets/js/24.0115c683.js"><link rel="prefetch" href="/assets/js/25.063673cf.js"><link rel="prefetch" href="/assets/js/26.553a1eb2.js"><link rel="prefetch" href="/assets/js/27.08c8ca14.js"><link rel="prefetch" href="/assets/js/28.1defb04c.js"><link rel="prefetch" href="/assets/js/29.7f63d316.js"><link rel="prefetch" href="/assets/js/30.a02cbcbe.js"><link rel="prefetch" href="/assets/js/31.adb9f207.js"><link rel="prefetch" href="/assets/js/32.46dee9a2.js"><link rel="prefetch" href="/assets/js/33.094076a6.js"><link rel="prefetch" href="/assets/js/34.708ca58e.js"><link rel="prefetch" href="/assets/js/35.39a635ba.js"><link rel="prefetch" href="/assets/js/36.2d584815.js"><link rel="prefetch" href="/assets/js/37.01308425.js"><link rel="prefetch" href="/assets/js/38.262a0714.js"><link rel="prefetch" href="/assets/js/39.80284e65.js"><link rel="prefetch" href="/assets/js/40.2879fd13.js"><link rel="prefetch" href="/assets/js/41.158e912b.js"><link rel="prefetch" href="/assets/js/42.c58fee20.js"><link rel="prefetch" href="/assets/js/43.5aaf43a4.js"><link rel="prefetch" href="/assets/js/44.94862a49.js"><link rel="prefetch" href="/assets/js/45.0a4a584f.js"><link rel="prefetch" href="/assets/js/46.1e2219a7.js"><link rel="prefetch" href="/assets/js/47.ca51b79c.js"><link rel="prefetch" href="/assets/js/48.728e7d37.js"><link rel="prefetch" href="/assets/js/49.8cbe2214.js"><link rel="prefetch" href="/assets/js/50.90886734.js"><link rel="prefetch" href="/assets/js/51.02fcb79f.js"><link rel="prefetch" href="/assets/js/52.f50dc280.js"><link rel="prefetch" href="/assets/js/53.75821f0d.js"><link rel="prefetch" href="/assets/js/54.cba4d0e2.js"><link rel="prefetch" href="/assets/js/55.58091ec8.js"><link rel="prefetch" href="/assets/js/56.cce160e6.js"><link rel="prefetch" href="/assets/js/57.54812f0a.js"><link rel="prefetch" href="/assets/js/58.b0598ac8.js"><link rel="prefetch" href="/assets/js/59.a76e0e53.js"><link rel="prefetch" href="/assets/js/6.0334a02c.js"><link rel="prefetch" href="/assets/js/60.1b9de80e.js"><link rel="prefetch" href="/assets/js/61.dc1019ab.js"><link rel="prefetch" href="/assets/js/62.3152e63c.js"><link rel="prefetch" href="/assets/js/63.7808daf5.js"><link rel="prefetch" href="/assets/js/64.214ce4e0.js"><link rel="prefetch" href="/assets/js/65.58078a74.js"><link rel="prefetch" href="/assets/js/66.98cf6119.js"><link rel="prefetch" href="/assets/js/67.61f80d56.js"><link rel="prefetch" href="/assets/js/68.29188b12.js"><link rel="prefetch" href="/assets/js/69.728711c6.js"><link rel="prefetch" href="/assets/js/7.b997b856.js"><link rel="prefetch" href="/assets/js/70.9951678f.js"><link rel="prefetch" href="/assets/js/71.f0f5aff1.js"><link rel="prefetch" href="/assets/js/72.da444938.js"><link rel="prefetch" href="/assets/js/73.3b19f90c.js"><link rel="prefetch" href="/assets/js/74.bbc43906.js"><link rel="prefetch" href="/assets/js/75.cf251bcf.js"><link rel="prefetch" href="/assets/js/76.68cd22ea.js"><link rel="prefetch" href="/assets/js/77.f7be8477.js"><link rel="prefetch" href="/assets/js/78.279df1a3.js"><link rel="prefetch" href="/assets/js/79.33ae02b9.js"><link rel="prefetch" href="/assets/js/8.67497ace.js"><link rel="prefetch" href="/assets/js/80.6c0625e1.js"><link rel="prefetch" href="/assets/js/81.8b72486b.js"><link rel="prefetch" href="/assets/js/82.faf6c667.js"><link rel="prefetch" href="/assets/js/83.9d1b0742.js"><link rel="prefetch" href="/assets/js/84.36bf935a.js"><link rel="prefetch" href="/assets/js/85.4936445e.js"><link rel="prefetch" href="/assets/js/86.869b62e7.js"><link rel="prefetch" href="/assets/js/87.1a29b124.js"><link rel="prefetch" href="/assets/js/88.d845e162.js"><link rel="prefetch" href="/assets/js/89.629e43f3.js"><link rel="prefetch" href="/assets/js/9.a80f5c69.js"><link rel="prefetch" href="/assets/js/90.2911ac34.js"><link rel="prefetch" href="/assets/js/91.02374044.js"><link rel="prefetch" href="/assets/js/92.dd00b42e.js"><link rel="prefetch" href="/assets/js/93.807f704a.js"><link rel="prefetch" href="/assets/js/94.07093a44.js"><link rel="prefetch" href="/assets/js/95.764c7431.js"><link rel="prefetch" href="/assets/js/96.559f667a.js"><link rel="prefetch" href="/assets/js/97.28b86b54.js"><link rel="prefetch" href="/assets/js/98.45e20e2e.js"><link rel="prefetch" href="/assets/js/99.2eb03431.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.6345e35b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3eafe263.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en/" class="home-link router-link-active"><img src="/images/logo.png" alt="TOP Developer documentation" class="logo"> <span class="site-name can-hide">TOP Developer documentation</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="guide" class="dropdown-title"><span class="title">guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="guide" class="mobile-dropdown-title"><span class="title">guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://localhost:8080/static/docs-en.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">
  guide
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/AboutTOPNetwork/Protocol/ConsensusProtocol/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/AboutTOPNetwork/Protocol/ConsensusProtocol/" class="nav-link">
  中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="guide" class="dropdown-title"><span class="title">guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="guide" class="mobile-dropdown-title"><span class="title">guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://localhost:8080/static/docs-en.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">
  guide
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/AboutTOPNetwork/Protocol/ConsensusProtocol/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/AboutTOPNetwork/Protocol/ConsensusProtocol/" class="nav-link">
  中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>About TOP Network</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/AboutTOPNetwork/TOPNetworkPlatform/" class="sidebar-link">TOP Network Platform</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/en/AboutTOPNetwork/TOPChainInfrastructure/Overview" class="sidebar-heading clickable"><span>TOP Network Infrastructure</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/en/AboutTOPNetwork/Protocol/OverView" class="sidebar-heading clickable open"><span>TOP Network Protocol</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/AboutTOPNetwork/Protocol/TOPNetwokP2PNetwork/" class="sidebar-link">TOP Network P2P Network Protocol</a></li><li><a href="/en/AboutTOPNetwork/Protocol/AccountProtocol/" class="sidebar-link">Account Protocol</a></li><li><a href="/en/AboutTOPNetwork/Protocol/ResourceModel/" class="sidebar-link">Resource Model</a></li><li><a href="/en/AboutTOPNetwork/Protocol/EconomicModel/" class="sidebar-link">Economic Model</a></li><li><a href="/en/AboutTOPNetwork/Protocol/TransactionProtocol/" class="sidebar-link">Transaction Protocol</a></li><li><a href="/en/AboutTOPNetwork/Protocol/ConsensusProtocol/" aria-current="page" class="active sidebar-link">Consensus Protocol</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/AboutTOPNetwork/Protocol/ConsensusProtocol/#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/en/AboutTOPNetwork/Protocol/ConsensusProtocol/#three-layer-consensus-network" class="sidebar-link">Three Layer Consensus Network</a></li><li class="sidebar-sub-header"><a href="/en/AboutTOPNetwork/Protocol/ConsensusProtocol/#consensus-algorithm" class="sidebar-link">Consensus Algorithm</a></li><li class="sidebar-sub-header"><a href="/en/AboutTOPNetwork/Protocol/ConsensusProtocol/#transaction-consensus-process" class="sidebar-link">Transaction Consensus Process</a></li><li class="sidebar-sub-header"><a href="/en/AboutTOPNetwork/Protocol/ConsensusProtocol/#table-block-status" class="sidebar-link">Table Block Status</a></li></ul></li></ul></section></li><li><a href="/en/AboutTOPNetwork/Security/" class="sidebar-link">Security</a></li><li><a href="/en/AboutTOPNetwork/Glossary/" class="sidebar-link">Glossary</a></li><li><a href="/en/AboutTOPNetwork/Download/learningResource/" class="sidebar-link">Download</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TOP Network Node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Smart Contract</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>On-chain Governance</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TOPIO</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>RPC API Reference</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Wallet Integration Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SDKs</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page" data-v-64d2c529> <nav class="breadcrumbs fixed" data-v-c65b7bde data-v-64d2c529><div class="nav-wrapper" data-v-c65b7bde><a href="/en/" class="breadcrumb router-link-active" data-v-c65b7bde>Home</a><a href="/en/AboutTOPNetwork/Protocol/ConsensusProtocol/" aria-current="page" class="breadcrumb router-link-exact-active router-link-active" data-v-c65b7bde>Consensus Protocol</a></div></nav> <div class="theme-default-content content__default" data-v-64d2c529><h1 id="consensus-protocol"><a href="#consensus-protocol" class="header-anchor">#</a> Consensus Protocol</h1> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>It is difficult to achieve data consistency in a distributed network of nodes.</p> <p>A node must be selected through a certain mechanism, and this node decides which transaction needs to be processed at this time. It broadcasts the execution result of this transaction to other nodes for verification or storage. Therefore, the consistency of node data in the entire network can be achieved . We call this node &quot;leader&quot;, and the mechanism for selecting the leader and reaching data agreement is called &quot;consensus mechanism&quot;.</p> <p>The leader is elected through the VRF-FTS. The chance of being selected as a hpPBFT leader according to the comprehensive stake of the node, more about comprehensive, please refer to <a href="/en/Node/NodeElection.html">Node Elections</a>.</p> <h2 id="three-layer-consensus-network"><a href="#three-layer-consensus-network" class="header-anchor">#</a> Three Layer Consensus Network</h2> <p><img src="ConsensusProtocol.assets/image-20200429115213180-1600998306679.jpg" alt="image-20200429115213180"></p> <p>The TOP Network consensus network is divided into three layers:<br>
The Edge Network: All transactions will be sent to edge network before reaching the audit network.</p> <p>The Audit Network: Consists of audit nodes randomly partitioned into clusters, and handles most of the bandwidth heavy operations such as cross-shard communication, and participate in transaction validation.</p> <p>The Validate Network: Consists of shard made up of validator nodes. This is where the transactions validation takes place. Within each shard, validator nodes validate and confirm transactions using a parallel hpPBFT algorithm.</p> <p>A tiered network is used for multiple reasons. First, splitting duties among multiple types of nodes helps keep node requirements low. The Audit Network handles most of the bandwidth heavy operations such as cross-shard communication, which allows validator nodes to have relatively low requirements. In addition, the Edge Network helps protect the Audit and Validate Network from spam attacks, as clients can only send transactions directly to edge Nodes.</p> <h2 id="consensus-algorithm"><a href="#consensus-algorithm" class="header-anchor">#</a> Consensus Algorithm</h2> <h3 id="highly-parallel-pbft"><a href="#highly-parallel-pbft" class="header-anchor">#</a> Highly-Parallel pBFT</h3> <p>TOP Network’s pBFT inspired algorithm, dubbed hpPBFT, adopts a three-phase commit stratagem which permits O(n) communication complexity with O(n) view-change complexity. The algorithm uses VRF time-based view changes, but adds additional security through a secondary audit network, and increased scalability through parallelization.</p> <h3 id="secondary-audit"><a href="#secondary-audit" class="header-anchor">#</a> Secondary Audit</h3> <p>TOP Network’s hpPBFT avoids this issue by making a change to the protocol which lowers the view-change complexity to O(n), while increasing security. The view-change process is simplified by using a 3-phase commit paradigm instead of the usual 2-phase commit. While inserting an extra phase adds a small amount of latency, it is well worth it to achieve linear leader replacement complexity.</p> <p>Security of the protocol is increased by introducing an audit committee and leader from the audit network. During each view, the audit committee performs their owns checks along with the original pBFT group. As a result, consensus does not rely too heavily on the original pBFT leader. Even if a shard is compromised or the leader is malicious, the audit network will prevent any invalid state transitions.</p> <p><img src="ConsensusProtocol.assets/image-20200430134830691.png" alt="image-20200430134830691"></p> <h3 id="completely-parallel-consensus"><a href="#completely-parallel-consensus" class="header-anchor">#</a> Completely Parallel Consensus</h3> <p>TOP applies several techniques to produce a high degree of parallelization. Besides the obvious parallel nature of sharding in general, TOP implements several other forms of parallelization.</p> <h4 id="node-virtualization-over-multiple-cpu-cores"><a href="#node-virtualization-over-multiple-cpu-cores" class="header-anchor">#</a> Node Virtualization Over Multiple CPU Cores</h4> <p>In our design, each node can take on multiple roles simultaneously. For instance, an Advance node can perform the duties of a Validator node concurrently. The necessary code for each type of node is assigned to run on separate CPU cores. This expands the total useful work a node can do, and essentially increases node count, thus increases overall scalability. It also helps to make shards more secure, as Advance nodes which have higher staking requirements can act as Validators, making it harder for attackers to gain the majority of stake within a shard. To be eligible for this functionality, a node needs to meet the minimum deposit and voting requirements set for Advance nodes.</p> <h4 id="parallel-subset-committee-consensus"><a href="#parallel-subset-committee-consensus" class="header-anchor">#</a> Parallel Subset Committee Consensus</h4> <p>As with all sharding designs, each shard can perform transaction validation in parallel with other shards. However, TOP goes one step further and allows for further parallelization within a shard. For each transaction sent from each account, a subset of nodes within the destination shard is randomly selected via VRF-FTS algorithm to form a consensus committee. If multiple transactions from accounts within the same account subspace are sent at the same time, multiple sub-committees within the associated shard will be selected simultaneously. In some cases, the same Validator node will be selected to participate in multiple sub-committees at the same time. This is accomplished through multi-threading techniques.<br>
Each node can use multiple threads to execute the consensus algorithm in multiple sub-groups at the same time (fig 6). This extra level of parallelization is made possible due to the account chain model discussed in chapter <a href="/en/AboutTOPNetwork/TOPChainInfrastructure/DataStructure.html">Chain Data Structure</a>.</p> <p><img src="ConsensusProtocol.assets/Snap18.jpg" alt="Snap18"></p> <h3 id="pos"><a href="#pos" class="header-anchor">#</a> PoS*</h3> <p>pBFT algorithms on their own are not secure in a permissionless setting. Instead, these algorithms need to be paired with some form of Sybil resistance. For blockchains like Bitcoin and Ethereum, PoW is used as the Sybil resistance mechanism. However, PoW is very energy inefficient, and requires nodes to use expensive mining equipment. TOP Network Chain instead uses Proof-of-Stake (PoS) to prevent Sybil attacks.<br>
PoS dictates that nodes must deposit stake in the form of the native blockchain token in order to join the network. This makes it expensive for malicious entities to gain control of enough nodes to launch attacks.</p> <p>In most forms of PoS, the only factor determining a node’s eligibility to join the network is a minimum deposit of the blockchain’s native token. TOP expands this concept into what we call Comprehensive Stake—which is represented by the the * in hpPBFT-PoS*. Comprehensive stake takes into account multiple factors to determine how likely a node is to participate in consensus. These are:</p> <p><strong>Deposit</strong>: The main component of the Comprehensive Stake is the number of TOP tokens deposited. Each types of node on TOP has differing requirements in terms of the minimum deposit to be eligible.<br> <strong>Credit</strong>: A node’s contribution history is used as a form of credit or reputation. The more jobs successfully completed by a node, the higher its credit, and thus Comprehensive Stake. If a node’s bandwidth or compute power is too low compared to the rest of the nodes, its reputation score will drop.</p> <p><strong>Voting</strong>: Any token holder can use their tokens to vote for a particular node. The more votes a node receives, the higher its chances of election. TOP allows for proxy voting via smart-contract. Token holders can pledge their tokens to another individual or organization to vote on their behalf.</p> <h2 id="transaction-consensus-process"><a href="#transaction-consensus-process" class="header-anchor">#</a> Transaction Consensus Process</h2> <p>Single account transactions only need a round of consensus, the transaction sending account and receiving account are the same, the account operation its own properties.</p> <p>Cross-account transactions need three rounds of consensus:</p> <p>Taking account A to account B transfer 200 TOP token as an example, the cross-account transaction consensus process is shown in the figure below.</p> <p><img src="ConsensusProtocol.assets/Snap76-1601019157203.jpg" alt="Snap76"></p> <p>1.The transaction is routed to Network 1 where account A is located.</p> <p>2.The sender transaction consensus was successful, and the balance of account A decreased by 200 TOP.</p> <p>Sender transaction process:</p> <p>The hpPBFT leader verifies the transaction at first. After the verification, the verification results will be broadcast to other nodes in Network 1, and the other nodes will verify the results. When the leader receives the signature or votes from 2/3 nodes in Network 1, the consensus will be successful, and the block will be stored in the database. Meanwhile, the balance of account A is reduced by 200 TOP.</p> <p>3.Post the transaction and transaction sending receipt to Network 1 where the account A is located.</p> <p>The transaction receipt consists of the transaction multiple signatures and the Merkle tree path. The function of the transaction receipt is to prove that the transaction consensus is  successful, including sending transaction receipt and receiving transaction receipt.</p> <p>4.The receiver transaction consensus was successful, and the balance of account B increased by 200 TOP.</p> <p>Refer to the process of sending transaction consensus to gain a better understanding of how this works.</p> <p>5.Post the receiving transaction receipt to Network 1 where the account A is located.</p> <p>6.Each node in Network 1 confirms that the transaction receipt. If the transaction is timed out and has not been received, the transaction sending receipt will be reposted.</p> <h2 id="table-block-status"><a href="#table-block-status" class="header-anchor">#</a> Table Block Status</h2> <p>The transaction will go through three rounds of consensus before it is finally confirmed, and each consensus block will go through the following three states.</p> <p><img src="ConsensusProtocol.assets/Snap80.jpg" alt="Snap80"></p> <p>After the first consensus, the state of the block will be &quot;HighQC&quot;; after the second consensus, the state of the block will change to the &quot;Lock&quot; state; after the third consensus, the state of the block will change to the final confirmation state &quot;Commit&quot;.</p> <p>The consensus leader will be updated in each round of consensus and when the new leader finds that there are no transactions in the transaction pool, an empty block is created to help the last block to reach the &quot;Commit&quot; status.</p></div> <div class="content-footer" data-v-64d2c529><div class="page-nav" data-v-64d2c529><p class="inner"><span class="prev">
      ←
      <a href="/en/AboutTOPNetwork/Protocol/TransactionProtocol/" class="prev">
        Transaction Protocol
      </a></span> <span class="next"><a href="/en/AboutTOPNetwork/Security/">
        Security
      </a>
      →
    </span></p></div> <footer class="page-edit" data-v-64d2c529><!----> <!----></footer></div> <div data-v-64d2c529></div> <div data-v-64d2c529></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.a0770211.js" defer></script><script src="/assets/js/5.8d217a8a.js" defer></script><script src="/assets/js/1.dc65fe2a.js" defer></script><script src="/assets/js/4.29ff2e2e.js" defer></script><script src="/assets/js/17.f75481fe.js" defer></script>
  </body>
</html>
